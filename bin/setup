#!/usr/bin/env php
<?php

require_once 'vendor/autoload.php';
require __DIR__ . '/../app/bootstrap.php';

use Doctrine\Common\Annotations\AnnotationRegistry;
use JMS\Serializer\SerializerBuilder;
use Magento\Framework\App\ObjectManager;
use Magento\Framework\Console\Cli;
use Sitewards\Setup\Command\Page\Dump;
use Sitewards\Setup\Persistence\PageRepository;
use Sitewards\Setup\Service\Page\Dumper\Dumper;
use Symfony\Component\Console\Application;
use Symfony\Component\Filesystem\Filesystem;

AnnotationRegistry::registerAutoloadNamespace(
    'JMS\Serializer\Annotation',
    'vendor/jms/serializer/src'
);

$coreCliApplication = new Cli();
$objectManager      = ObjectManager::getInstance();

$serializer = SerializerBuilder::create()->build();

$mage2Bridge = new PageRepository(
    $objectManager->get('\Magento\Cms\Api\PageRepositoryInterface'),
    $objectManager->get('\Magento\Framework\Api\SearchCriteriaBuilder')
);

$dumper = new Dumper($mage2Bridge, $serializer, new Filesystem());

$application = new Application();
$application->add(new Dump($dumper));
$application->run();
